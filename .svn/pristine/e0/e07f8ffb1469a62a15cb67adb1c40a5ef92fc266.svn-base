import { Component, OnInit } from '@angular/core';
import {GridOptions} from 'ag-grid';

@Component({
  selector: 'app-recomendaciones',
  templateUrl: './recomendaciones.component.html',
  styleUrls: ['./recomendaciones.component.css']
})
export class RecomendacionesComponent {

  gridOptions: GridOptions;
  columnDefs: any[];
  rowData: any[];
  domLayout;
  getRowHeight;

  constructor() {
    this.gridOptions = <GridOptions>{};

    this.columnDefs = [
      {headerName: 'Empresa', field: 'Empresa', pinned: 'left', minWidth: 200, maxWidth: 400, cellStyle: { 'font-weight': '600', 'justify-content': 'left' }  },
      {headerName: 'Último Precio', field: 'UltimoPrecio', minWidth: 80, cellRenderer: this.CurrencyCellRenderer},
      {headerName: 'Precio Objetivo', field: 'PrecioObjetivo', minWidth: 80 },
      {headerName: 'Potencial', field: 'Potencial', minWidth: 80 },
      {headerName: 'PER 2018e', field: 'PER2018e', minWidth: 80 },
      {headerName: 'PRent.Dividendo (%)18e', field: 'RentDividendo18e', minWidth: 80 },
      {headerName: 'EV/EBITDA 18e', field: 'EVEBITDA18e', minWidth: 80 },
      {headerName: 'P/BV 18e', field: 'PBV18e', minWidth: 80 },
      {headerName: 'DN/EBITDA 18e', field: 'DNEBITDA18e', minWidth: 80 },
      {headerName: 'Capitalización', field: 'Capitalizacion', minWidth: 80 },
      {headerName: 'Max 52 Semanas', field: 'Max52Semanas', minWidth: 80 },
      {headerName: 'Min 52 Semanas', field: 'Min52Semanas', minWidth: 80 },
      {headerName: 'Recomendación', field: 'Recomendacion', minWidth: 90 },
      {headerName: 'Precio Objetivo Consenso', field: 'PrecioObjetivoConsenso', minWidth: 80 }
    ];

    this.rowData = [
      {
        Empresa: 'Nombre de empresa grande a 2 lineas adad aa Nombre de empresa grande a 2 lineas adad aaNombre de empresa grande a 2 lineas adad aaNombre de empresa grande a 2 lineas adad aaNombre de empresa grande a 2 lineas adad aaNombre de empresa grande a 2 lineas adad Fin ',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      },
      {
        Empresa: 'Nombre de Empresa',
        UltimoPrecio: 999999,
        PrecioObjetivo: 999.999,
        Potencial: 999.99,
        PER2018e: 999.99,
        RentDividendo18e: 999.99,
        EVEBITDA18e: 999.99,
        PBV18e: 999.99,
        DNEBITDA18e: 999.99,
        Capitalizacion: 999999.99,
        Max52Semanas: 999.999,
        Min52Semanas: 999.999,
        Recomendacion: 'Accumulate',
        PrecioObjetivoConsenso: 999.999,
      }
    ];
    this.domLayout = 'autoHeight';
    this.getRowHeight = function(params) {
      return 18 * (Math.floor(params.data.Empresa.length / 25) + 2);
    };
  }


  onGridSizeChanged(params) {
    const gridWidth = document.getElementById('grid-wrapper').offsetWidth;
    const columnsToShow = [];
    const columnsToHide = [];
    let totalColsWidth = 0;
    const allColumns = params.columnApi.getAllColumns();
    for (let i = 0; i < allColumns.length; i++) {
      const column = allColumns[i];
      totalColsWidth += column.getMinWidth();
    }
    params.columnApi.setColumnsVisible(columnsToShow, true);
    params.columnApi.setColumnsVisible(columnsToHide, false);
    params.api.sizeColumnsToFit();
  }

  onGridReady(params) {
    params.api.sizeColumnsToFit();
  }


  private CurrencyCellRenderer(params) {
    return formatNumber(params.value) + '€';
    function formatNumber(number) {
      // this puts commas into the number eg 1000 goes to 1,000,
      // i pulled this from stack overflow, i have no idea how it works
      return Math.floor(number).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,  '$1,');
    }
  }

}
